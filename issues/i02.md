# Issue #02: @playwright/mcpãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®Chromiumèªè­˜å•é¡Œ

**å ±å‘Šæ—¥**: 2025-11-16
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: èª¿æŸ»å®Œäº†
**å„ªå…ˆåº¦**: é«˜

## å•é¡Œã®æ¦‚è¦

`npx -y @playwright/mcp@latest --browser chromium`ã§èµ·å‹•ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿï¼š

```
Browser specified in your config is not installed. Either install it (likely) or change the config.
```

`npx playwright install chromium`ã§Chromiumã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ï¼ˆ`~/.cache/ms-playwright/chromium-1194/`ï¼‰ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒèªè­˜ã•ã‚Œãªã„ã€‚

## æ ¹æœ¬åŸå› 

### 1. npxå®Ÿè¡Œæ™‚ã®åˆ†é›¢ç’°å¢ƒ

`npx`çµŒç”±ã§`@playwright/mcp`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå•é¡ŒãŒç™ºç”Ÿï¼š

- **ä¸€æ™‚çš„ãªnode_modules**: npxã¯ä¸€æ™‚çš„ãªå ´æ‰€ã«`@playwright/mcp`ã¨ãã®ä¾å­˜é–¢ä¿‚ï¼ˆ`playwright@1.57.0-alpha-2025-11-14`ã€`playwright-core@1.57.0-alpha-2025-11-14`ï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸ä¸€è‡´**: äº‹å‰ã«`npx playwright install chromium`ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸChromiumã¯ã€åˆ¥ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®Playwrightã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸå¯èƒ½æ€§ãŒã‚ã‚‹
- **ãƒ–ãƒ©ã‚¦ã‚¶ãƒ‘ã‚¹èªè­˜ã®å•é¡Œ**: å„Playwrightã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ã€è‡ªèº«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿ã‚’èªè­˜ã™ã‚‹

### 2. Playwrightã®ãƒ–ãƒ©ã‚¦ã‚¶èªè­˜ãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

Playwrightã¯ä»¥ä¸‹ã®é †åºã§ãƒ–ãƒ©ã‚¦ã‚¶ã‚’æ¤œç´¢ï¼š

1. **PLAYWRIGHT_BROWSERS_PATHç’°å¢ƒå¤‰æ•°**ï¼ˆæœ€å„ªå…ˆï¼‰
2. **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**:
   - Linux: `~/.cache/ms-playwright`
   - macOS: `~/Library/Caches/ms-playwright`
   - Windows: `%USERPROFILE%\AppData\Local\ms-playwright`

ã—ã‹ã—ã€**å„Playwrightãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã€ãã‚Œãã‚Œç‹¬è‡ªã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æœŸå¾…**ã™ã‚‹ã€‚

### 3. ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã®å•é¡Œ

```bash
# ä¾‹: ä»¥å‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸChromium
~/.cache/ms-playwright/chromium-1194/

# @playwright/mcpãŒæœŸå¾…ã™ã‚‹Chromiumãƒãƒ¼ã‚¸ãƒ§ãƒ³
# playwright@1.57.0-alpha-2025-11-14 ãŒæœŸå¾…ã™ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³
# â†’ ç•°ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
```

## å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰ã®é‡è¦ãªç™ºè¦‹

**å‡ºå…¸**: https://playwright.dev/docs/browsers

- **PLAYWRIGHT_BROWSERS_PATH**: ãƒ–ãƒ©ã‚¦ã‚¶ãƒã‚¤ãƒŠãƒªã®ä¿å­˜å ´æ‰€ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½
- **å…±æœ‰ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³**: è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–“ã§ãƒ–ãƒ©ã‚¦ã‚¶ã‚’å…±æœ‰å¯èƒ½
- **Hermetic install**: `PLAYWRIGHT_BROWSERS_PATH=0`ã§`node_modules/playwright-core/.local-browsers`ã«ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ãƒ­ãƒ¼ã‚«ãƒ«é…ç½®

## è§£æ±ºç­–

### è§£æ±ºç­–1: PLAYWRIGHT_BROWSERS_PATHã‚’æ˜ç¤ºçš„ã«è¨­å®šï¼ˆæ¨å¥¨ï¼‰

**ensure-playwright.jsã®ä¿®æ­£**:

```javascript
#!/usr/bin/env node

const { execSync } = require('child_process');
const fs = require('fs');
const path = require('path');
const os = require('os');

const PLUGIN_ROOT = process.env.CLAUDE_PLUGIN_ROOT || __dirname;
const FLAG_FILE = path.join(os.homedir(), '.claude-ndf-playwright-installed');
const BROWSER_PATH = path.join(os.homedir(), '.cache', 'ms-playwright');
const TIMEOUT_MS = 5 * 60 * 1000;

// æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆå†ªç­‰æ€§ï¼‰
if (fs.existsSync(FLAG_FILE)) {
  process.exit(0);
}

console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
console.log('ğŸ­ NDF Plugin: åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—');
console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
console.log('');
console.log('Playwright Chromiumãƒ–ãƒ©ã‚¦ã‚¶ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­...');
console.log('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã«ã‚ˆã‚Š1-2åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚');
console.log('');

try {
  // PLAYWRIGHT_BROWSERS_PATHã‚’è¨­å®šã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
  execSync('npx @playwright/mcp@latest install chromium', {
    stdio: 'inherit',
    cwd: PLUGIN_ROOT,
    timeout: TIMEOUT_MS,
    env: {
      ...process.env,
      PLAYWRIGHT_BROWSERS_PATH: BROWSER_PATH,
      PLAYWRIGHT_SKIP_BROWSER_GC: '1'
    }
  });

  // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æˆåŠŸãƒ•ãƒ©ã‚°ã‚’ä½œæˆ
  const flagData = {
    installed: new Date().toISOString(),
    plugin: 'ndf',
    browser: 'chromium',
    browserPath: BROWSER_PATH
  };

  fs.writeFileSync(FLAG_FILE, JSON.stringify(flagData, null, 2));

  console.log('');
  console.log('âœ… ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ï¼Playwright Chromiumã®æº–å‚™ãŒã§ãã¾ã—ãŸã€‚');
  console.log(`   ãƒ–ãƒ©ã‚¦ã‚¶ãƒ‘ã‚¹: ${BROWSER_PATH}`);
  console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
  process.exit(0);

} catch (error) {
  console.error('');
  console.error('âŒ Playwright Chromiumã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ');
  console.error('');
  console.error('ã‚¨ãƒ©ãƒ¼:', error.message);
  console.error('');
  console.error('æ‰‹å‹•ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„:');
  console.error(`  PLAYWRIGHT_BROWSERS_PATH=${BROWSER_PATH} npx @playwright/mcp@latest install chromium`);
  console.error('');
  console.error('ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°:');
  console.error('  https://playwright.dev/docs/browsers');
  console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
  process.exit(1);
}
```

**MCPè¨­å®šï¼ˆ.mcp.jsonã¾ãŸã¯.claude.jsonï¼‰**:

```json
{
  "mcpServers": {
    "playwright": {
      "command": "npx",
      "args": ["-y", "@playwright/mcp@latest", "--browser", "chromium", "--isolated", "--no-sandbox"],
      "env": {
        "PLAYWRIGHT_BROWSERS_PATH": "${HOME}/.cache/ms-playwright"
      }
    }
  }
}
```

### è§£æ±ºç­–2: @playwright/mcpã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

**package.jsonã«è¿½åŠ **:

```json
{
  "dependencies": {
    "@playwright/mcp": "^0.0.47"
  }
}
```

**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**:

```bash
npm install
npx playwright install chromium
```

**MCPè¨­å®š**:

```json
{
  "mcpServers": {
    "playwright": {
      "command": "node",
      "args": ["${PLUGIN_ROOT}/node_modules/@playwright/mcp/cli.js", "--browser", "chromium", "--isolated", "--no-sandbox"]
    }
  }
}
```

### è§£æ±ºç­–3: install toolã‚’è¿½åŠ ï¼ˆ@playwright/mcp v0.0.47ä»¥é™ï¼‰

READMEã«ã‚ˆã‚‹ã¨ã€`browser_install` toolãŒåˆ©ç”¨å¯èƒ½ï¼š

```json
{
  "mcpServers": {
    "playwright": {
      "command": "npx",
      "args": ["-y", "@playwright/mcp@latest", "--caps", "install"]
    }
  }
}
```

ãã®å¾Œã€MCPãƒ„ãƒ¼ãƒ«çµŒç”±ã§ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼š

```javascript
mcp__plugin_ndf_playwright__browser_install()
```

## æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

1. **è§£æ±ºç­–1ã‚’æ¡ç”¨**: `PLAYWRIGHT_BROWSERS_PATH`ç’°å¢ƒå¤‰æ•°ã‚’æ˜ç¤ºçš„ã«è¨­å®šã™ã‚‹æ–¹æ³•ãŒæœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ç¢ºå®Ÿ
2. **ensure-playwright.jsã‚’æ›´æ–°**: `npx @playwright/mcp@latest install chromium`ã‚’ä½¿ç”¨ã—ã€ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
3. **MCPè¨­å®šã‚’æ›´æ–°**: `.mcp.json`ã¾ãŸã¯`.claude.json`ã«ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ 
4. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®READMEã«æ­£ã—ã„ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã‚’è¨˜è¼‰

## æ¤œè¨¼æ‰‹é †

```bash
# 1. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
PLAYWRIGHT_BROWSERS_PATH=~/.cache/ms-playwright npx @playwright/mcp@latest install chromium

# 2. MCPè¨­å®šã«ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ 
# .mcp.json ã¾ãŸã¯ .claude.json ã‚’ç·¨é›†

# 3. MCPã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã—ã¦ãƒ†ã‚¹ãƒˆ
# Claude Codeã‚’å†èµ·å‹•
```

## å‚è€ƒè³‡æ–™

- [@playwright/mcp README](https://www.npmjs.com/package/@playwright/mcp)
- [Playwright Browsers Documentation](https://playwright.dev/docs/browsers)
- [Playwright PLAYWRIGHT_BROWSERS_PATH](https://playwright.dev/docs/browsers#managing-browser-binaries)

## é–¢é€£Issue

ãªã—

## ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

- [x] å•é¡Œç‰¹å®š
- [x] è§£æ±ºç­–ææ¡ˆ
- [ ] ä¿®æ­£å®Ÿè£…
- [ ] ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
